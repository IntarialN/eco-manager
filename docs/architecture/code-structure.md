# Структура файлов, компонентов и приложений

Документ задаёт целевую структуру репозитория для MVP, включая разбиение на приложения, директории, модули и правила размещения артефактов. Базовый принцип — модульность и независимость компонентов для упрощения масштабирования и микросервисного подхода.

## 1. Общая схема репозитория

```
/
├── apps/
│   ├── web-client/           # фронтенд личного кабинета (SPA)
│   ├── admin-console/        # интерфейс админ-панели (можно совместно с web-client)
│   └── api-gateway/          # точка входа публичного API (GraphQL/REST)
├── .github/
│   └── workflows/            # GitHub Actions (CI/CD)
├── services/
│   ├── requirements-service/ # сервис расчёта и управления требованиями
│   ├── documents-service/    # сервис хранения и аудита документов
│   ├── calendar-service/     # сервис календаря и уведомлений
│   ├── risk-service/         # модуль расчёта рисков
│   └── billing-service/      # интеграция договоров/счетов (API Бабл)
├── libs/
│   ├── ui-kit/               # общие UI-компоненты для фронтенда
│   ├── data-models/          # описания DTO/ORM моделей, используемых между сервисами
│   └── utils/                # общие вспомогательные функции (логирование, валидация)
├── infra/
│   ├── docker/               # Dockerfile, docker-compose для локальной разработки
│   ├── terraform/            # описание облачной инфраструктуры (если нужно)
│   ├── k8s/                  # манифесты Kubernetes/Helm
│   └── ci-cd/                # пайплайны CI (GitHub Actions, GitLab CI)
├── packages/                 # конфигурации Nx (workspace.json, project.json, nx.json)
├── docs/                     # проектная документация (см. README)
├── scripts/                  # утилиты (миграции, генераторы данных, линтеры)
├── config/                   # конфигурации (env-шаблоны, feature-flags)
└── tests/                    # интеграционные/конечные тесты (e2e)
```

## 2. Приложения (`apps/`)

- `web-client`: SPA на React + TypeScript + Vite + Tailwind CSS, структура:
  ```
  apps/web-client/
  ├── src/
  │   ├── app/               # корневые компоненты и роутинг
  │   ├── features/          # доменные модули (requirements, calendar, documents, risks, billing)
  │   ├── entities/          # базовые сущности (client, site, requirement)
  │   ├── shared/            # общие компоненты, хелперы, хуки
  │   └── widgets/           # комплексные блоки интерфейса (dashboards, таблицы)
  ├── public/
  ├── vite.config.ts
  └── package.json
  ```
- `admin-console`: отдельный build таргет на базе React/Vite с переиспользованием `libs/ui-kit`.
- `api-gateway`: NestJS-приложение (TypeScript), обеспечивает аутентификацию (JWT), авторизацию, GraphQL/REST слой для фронтенда.

## 3. Сервисы (`services/`)

Каждый сервис имеет типовую структуру:
```
services/<service-name>/
├── src/
│   ├── domain/            # сущности, агрегаты, бизнес-логика
│   ├── application/       # use-case слои, оркестрация
│   ├── infrastructure/    # ORM, адаптеры БД, шлюзы к внешним сервисам
│   └── interfaces/        # REST/GraphQL контроллеры, подписчики очередей
├── migrations/            # скрипты БД
├── tests/
├── config/
└── package.json
```

- `requirements-service`: отвечает за расчёт требований (правила из `docs/requirements/`), хранение статусов и историю.
- `documents-service`: управляет файлами, версионированием, аудитом; интегрируется с объектным хранилищем.
- `calendar-service`: генерирует события, управляет напоминаниями, синхронизирует с уведомлениями.
- `risk-service`: рассчитывает риск-профили, хранит планы действий.
- `billing-service`: синхронизируется с учётной системой, управляет договорами/счетами/актами.

Все сервисы реализуются на NestJS, используют Prisma ORM и общие пакеты из `libs/data-models`.

## 4. Общие библиотеки (`libs/`)

- `ui-kit`: дизайн-система, компоненты (кнопки, формы, таблицы).
- `data-models`: TypeScript/Proto/GraphQL схемы, используемые между сервисами.
- `utils`: логирование, обработка ошибок, валидация, шифрование.
- Рекомендовано использовать Nx (или Turborepo) для оркестрации сборок NestJS/React-проектов и кэширования.

## 5. Конфигурации (`config/`)

- `config/env/` — шаблоны `.env` для разных окружений (dev, stage, prod).
- `config/security/` — политики (CORS, rate limiting, шифрование).
- `config/rbac/` — JSON/YAML с описанием ролей и разрешений (синхронизируется с `docs/admin/roles-and-permissions.md`).
- `config/notifications/` — настройки каналов уведомлений (email, чат-бот).
- `config/queue/` — параметры подключения к RabbitMQ (обменники, очереди).

## 6. Инфраструктура (`infra/`)

- `docker/` — Dockerfile для React-приложений и NestJS-сервисов, docker-compose для PostgreSQL, Redis, RabbitMQ, MinIO.
- `ci-cd/` — шаблоны GitHub Actions, Argo CD app-of-apps, scripts для релизов.
- `terraform/` — описывает ресурсы облака (БД, storage, очереди, секрет-менеджер).
- `k8s/` — манифесты деплоймента (Deployment, Service, Ingress, Secret).
- `ci-cd/` — пайплайны: lint, тесты, сборка, деплой, проверка миграций.

## 7. Scripts и Tests

- `scripts/` — миграции, сидеры данных, линтеры, генерация клиентов API.
- `tests/` — e2e-наборы (например, Playwright/Cypress для web-client, Postman/Newman для API). Для contract-тестов событий RabbitMQ — отдельный пакет в `tests/events`.
- Unit/интеграционные тесты живут внутри соответствующих сервисов/приложений.

## 8. Документация (`docs/`)

- Текущий раздел. Внутри `docs/` поддерживаем README, план, completed и спецификации по блокам.
- При добавлении новых сервисов/модулей — обновляем `docs/architecture/overview.md`.

## 9. Правила поддержки структуры

- Любой новый сервис или фронтенд-модуль добавляем в соответствующую директорию, обновляем `code-structure.md` и `overview.md`.
- Переиспользуемые компоненты выносим в `libs/` — запрет на дублирование кода между приложениями.
- Конфигурации окружений — только в `config/` (запрещено хранить их рядом с сервисом).
- Scripts/tests не должны зависеть от локальных путей — использовать относительные импорты и общие утилиты.
- Принятый стек зафиксирован в `docs/architecture/adr/0001-tech-stack.md`, инфраструктура — в `docs/architecture/adr/0002-infrastructure.md`; при изменениях поддерживаем актуальность документов.

## Чек-лист готовности

- [x] Определена целевая структура репозитория с каталогами и назначением.
- [x] Описаны структуры для приложений, сервисов, библиотек, инфраструктуры.
- [x] Зафиксированы правила поддержки и TODO для специфики стека.
- [x] Обновить `docs/architecture/overview.md` после подготовки общей схемы архитектуры.
