# ADR 0001 — Выбор технологического стека для MVP

Дата: 2025-11-05  
Статус: Принято (рабочее решение команды для тестового задания)

## Контекст

Необходимо выбрать стек технологий, на котором будет реализован MVP личного кабинета. Требования:

- Быстрый старт разработки малой командой.
- Поддержка модульности/микросервисного подхода.
- Наличие готовых решений для RLS, аутентификации, работы с файлами.
- Соответствие популярным стеком на рынке (легко найти специалистов).
- Возможность развёртывания в контейнерах и интеграции с CI/CD.

## Решение

| Компонент | Выбор | Обоснование |
|-----------|-------|-------------|
| Frontend (web-client, admin) | React + TypeScript + Vite | широкая экосистема, быстрое прототипирование, единый стек для клиента и админки; Vite обеспечивает быстрые сборки |
| Стили/дизайн | Tailwind CSS + Headless UI | ускоряет создание адаптивных интерфейсов без тяжёлой UI-библиотеки |
| API Gateway | NestJS (Node.js, TypeScript) | структурированный фреймворк с модульной архитектурой, поддержка GraphQL и REST, подходит для gateway |
| Бизнес-сервисы | NestJS (для requirements, documents, calendar, risk, billing) | единый стек, DI/декораторы упрощают поддержку, есть готовые модули для валидации и работы с БД |
| БД | PostgreSQL 15 | поддержка RLS, JSONB, mature экосистема, удобен для хранений связных данных |
| ORM/миграции | Prisma ORM | типобезопасные запросы в TypeScript, генерация миграций, поддержка монорепо |
| Очереди/события | RabbitMQ | простой брокер с поддержкой маршрутизации, достаточно для MVP, есть готовые адаптеры в NestJS |
| Кэш/сессии | Redis | быстрый in-memory кэш, поддержка pub/sub, TTL для сессий |
| Хранилище файлов | MinIO (dev/stage), Yandex Object Storage (prod) | MinIO для локальной разработки, S3-совместимость; YOS удовлетворяет требованиям РФ и доступен для прод |
| CI/CD | GitHub Actions | простая интеграция с GitHub, поддержка matrix билдов, секретов |
| Контейнеризация | Docker + docker-compose (dev), Kubernetes (prod) | докеры для локальной разработки, K8s обеспечивает масштабирование в проде |
| Мониторинг | Prometheus + Grafana + Loki + Alertmanager | открытые инструменты, легко интегрируются с Kubernetes |

## Последствия

- Команда использует TypeScript как основной язык (фронтенд + бэкенд), что уменьшает контекст переключения.
- NestJS даёт структурированный каркас, но требует знания DI и декораторов; потребуется минимальное обучение.
- RabbitMQ удовлетворяет MVP, однако при росте нагрузок возможно потребуется миграция на Kafka (см. раздел рисков).
- Prisma ограничивает нас PostgreSQL; при смене БД потребуется пересмотреть модели.
- Yandex Object Storage соответствует требованиям РФ, но привязывает нас к конкретному провайдеру (возможная миграция при расширении на другие рынки).

## Альтернативы

- **FastAPI (Python)**: проще писать отдельные сервисы, но команда делает ставку на единый язык и больший набор готовых модулей NestJS.
- **Go (Fiber/Gin)**: высокопроизводителен, но требует больше времени на разработку и меньше готовых решений для RLS и RBAC out-of-the-box.
- **Monorepo без микросервисов (Next.js)**: ускоряет MVP, но идёт вразрез с требованием модульности и разделения ответственности.

## Риски и дальнейшие действия

- Контроль версий Node.js и зависимости (следить за LTS).
- Подготовить boilerplate репозитория с конфигурацией ESLint/Prettier, Husky.
- Создать docker-compose для локального запуска PostgreSQL, Redis, RabbitMQ, MinIO.
- Задокументировать инструкцию по развёртыванию (см. раздел infra после реализации).
