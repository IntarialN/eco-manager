# План структурирования документации (текущая сессия)

Документ фиксирует рабочие этапы по детализации и сопровождению документации MVP. Используем как чек-лист на время текущей сессии: каждый завершённый блок фиксируем в `docs/completed/` отдельной записью.

## Этап 0. Аудит входного контекста
- Проанализировать все материалы в `docs/`, включая completed-лог, чтобы не дублировать уже выполненные задачи.
- Свериться с `docs/documentation-plan.md`, `docs/documentation-todo.md`, `docs/development-readiness.md`.
- Зафиксировать выявленные пробелы или несоответствия в `docs/documentation-todo.md`.

## Этап 1. Функциональные блоки MVP
- **Требования (`docs/features/requirements-tracker.md`)**
  - Проверить актуальность бизнес-правил (особенно req_11) и ссылок на `docs/requirements/`.
  - Дополнить UX и SLA, если появляются новые сценарии.
- **Артефакты (`docs/features/document-storage.md`)**
  - Уточнить маппинг типов документов ↔ НПА.
  - Проверить политику версионирования и аудита (связь с `reference-management.md`).
- **Календарь (`docs/features/calendar.md`)**
  - Досформировать события по договорам/счетам при прогрессе по интеграции Bubble.
  - Синхронизировать напоминания с notification-service.
- **Риски (`docs/features/risk-management.md`)**
  - Уточнить диапазоны штрафов и частоту проверок при поступлении официальных данных.
  - Согласовать логику планов действий с `docs/admin/reference-management.md`.
- **Договоры/Биллинг (`docs/features/contracts-billing.md`)**
  - Актуализировать статусы интеграции, ссылки на mock Bubble API и календарные события.
- Для каждого подблока: если вносим изменения, готовим запись в `docs/completed/` с указанием затронутых файлов и причин правок.

## Этап 2. Архитектура и интеграции
- **Codebase (`docs/architecture/code-structure.md`, `docs/architecture/overview.md`)**
  - Проверить, отражены ли последние изменения в Yii-прототипе и потенциальные микросервисы.
- **Модель данных и диаграммы (`docs/architecture/data-model.md`, `docs/architecture/diagrams/*.puml`)**
  - При изменении сущностей обновлять текст и диаграммы синхронно.
- **Интеграции (`docs/architecture/integration-plan.md`, `docs/architecture/mock-bubble-api.md`)**
  - Уточнять последовательности событий, SLA, форматы DTO.
  - Фиксировать новые интеграции (уведомления, внешние базы НПА).
- **ADR** — любые архитектурные решения документируем отдельным ADR (см. `docs/architecture/adr/`), обновляем индекс `docs/README.md`.

## Этап 3. Требования, справочники, админ-блок
- **Каталог и правила (`docs/requirements/*.md`)**
  - При поступлении новых нормативов обновлять таблицы, условия назначения.
- **Справочники (`docs/admin/reference-management.md`)**
  - Актуализировать НПА, типы документов, штрафы; вести журнал ручных корректировок.
- **Роли (`docs/admin/roles-and-permissions.md`)**
  - Проверять матрицу доступа при добавлении новых ролей или сценариев.
- **Клиентский профиль (`docs/client/*.md`)**
  - Расширять анкеты и маппинг при появлении дополнительных вопросов или интеграций.

## Этап 4. Безопасность, инфраструктура, runbook
- **Безопасность (`docs/security/compliance.md`)**
  - Подтверждать уровень защищённости, бэкапы, реагирование на инциденты.
- **Инфраструктура (`docs/infra/runbook.md`, ADR 0002)**
  - Обновлять инструкции по локальному окружению, CI/CD, деплою.
- **Git-процесс (`docs/project-git-workflow.md`)**
  - Следить за актуальностью веток, шаблонов PR, защитой веток.

## Этап 5. Поведение ИИ и правила работы
- Проверять и при необходимости расширять `docs/assistant-guidelines.md` (новые ограничения, процессы утверждения, шаблоны ответов).
- Уточнять, какие документы читать перед началом задачи: `documentation-plan`, `documentation-todo`, `completed/`.
- Напоминать себе:
  - Не переписывать историю — добавлять новые записи.
  - Обновлять `docs/README.md`, если появляются новые разделы.
  - Поддерживать внутренние ссылки между документами.

## Этап 6. Управление знаниями и фиксация результатов
- Перед завершением любой задачи:
  - Обновить профильные документы (фичи, архитектура, требования).
  - Синхронизировать статусы в `docs/documentation-todo.md`.
  - Создать запись в `docs/completed/` формата `YYYY-MM-DD-title.md` с контекстом, описанием и ссылками на артефакты.
- Регулярно (минимум раз за сессию) выполнять аудит:
  - `rg "TODO" docs` — перенос в таблицу TODO.
  - Проверка чек-листов в конце каждого файла (галочки отражают реальное состояние).

## Напоминания по фиксации прогресса
- Каждый этап или подэтап = отдельная запись в completed с перечислением изменённых файлов.
- Если задача затрагивает несколько этапов, допускается одна запись, но со списком всех отработанных подпунктов.
- При обновлении нескольких документов одной темой (например, интеграции) ссылаться на все затронутые файлы и коммиты.
- После мёрджа изменений не забывать обновить completed-лог и при необходимости индекс `docs/README.md`.
