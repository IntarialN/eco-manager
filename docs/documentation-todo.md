# Открытые вопросы и TODO

Таблица отражает задачи, которые команда может закрыть самостоятельно в рамках тестового задания. Для каждого пункта сформулировано рабочее предположение и план действий. При изменении статуса фиксируйте обновление в `docs/completed/`.

| Категория | Проблема | Рабочее решение команды | Верифицировать позже | Ответственный | Статус |
|-----------|----------|-------------------------|----------------------|---------------|--------|
| Требования | Бизнес-правило `req_11` (инструкции и приказы) | Подтверждено нормативами (ФЗ-89, Пост. №262): требование обязательно при наличии образования отходов и назначенного ответственного. Логика реализована в `docs/requirements/catalog.md` и `rules.md`, доступен флаг `need_instruction_docs`. | Нет | Аналитик требований | Готово |
| Аутентификация | Регистрация пользователей по email | Упростить тестирование: регистрация с выбором роли и автоматическим входом. | Да — добавить подтверждение email / ограничения ролей в прод | Backend | Готово |
| Документы | Маппинг типов документов ↔ НПА | Черновой список НПА и таблица соответствия типов документов отражены в `docs/admin/reference-management.md`; требуется юридическая верификация. | Да — свериться с юристами при доступе | Админ + юрист (при появлении) | Готово (ожидает верификации) |
| Календарь/Биллинг | События по договорам/счётам и API Bubble | Mock-API описан в `docs/architecture/mock-bubble-api.md`, реализована консольная синхронизация + вебхук (docker `yii billing/sync`), события и риски создаются автоматически. | Да — заменить mock на реальное API после получения спецификации | Интеграционная команда | Готово (mock + sync) |
| Риски | Штрафы, частота проверок, лента НПА | В `docs/features/risk-management.md` добавлены рабочие допущения (таблица штрафов, частота проверок, процесс обновления НПА). Требуется подтверждение отраслевых данных. | Да — уточнить значения при доступе к официальным базам | Аналитик рисков | Готово (ожидает подтверждения) |
| Риски | Синхронизация с требованиями и календарём | Статус риска обновляется в `RequirementController::actionUpdateStatus`, события календаря синхронизируются (см. `docs/features/calendar.md`). | Да — расширить реальную доставку уведомлений (email/чат) | Backend | Готово (план действий + NotificationService) |
| Документы | Управление файлами из карточки требования | Поддержан upload/approve/reject на странице требования; документация обновлена. | Да — уточнить разграничение ролей и аудит действий | Backend | Готово (unit-тесты + фронтенд-валидация) |
| Роли | Дополнительные роли (финансы, аудит) | Роли `finance_manager`, `auditor`, `external_viewer` добавлены в `docs/admin/roles-and-permissions.md` с матрицей доступа и политикой прав. | Нет | Админ RBAC | Готово |
| Правила требований | Конфликт между overrides и авторасчётом | Алгоритм конфликт-менеджмента описан в `docs/admin/reference-management.md` (preview пересчёт, приоритет overrides, контроль `expires_at`). | Нет | Архитектор | Готово |
| Архитектура | Технологический стек | ADR `docs/architecture/adr/0001-tech-stack.md` принят: NestJS + TypeScript + Prisma + PostgreSQL, RabbitMQ, Redis, React/Vite/Tailwind. Обновлены `code-structure.md`, `overview.md`, `integration-plan.md`. | Да — пересмотреть при изменении ограничений | Техлид | Готово |
| Архитектура | Брокер сообщений и формат | Решение: RabbitMQ + JSON-сообщения, схемы в `libs/data-models/events`; отражено в `integration-plan.md`. Подготовить docker-compose сервис при старте разработки. | Да — пересмотреть при росте нагрузок | Архитектор | Готово |
| Архитектура | Диаграммы (компонентная, ERD, последовательности) | Подготовлены PlantUML диаграммы (`component.puml`, `erd.puml`, `sequence_document_upload.puml`) в `docs/architecture/diagrams/`. | Нет | Архитектор/BA | Готово |
| Хранилище/Инфра | Объектное хранилище и сертификация | Решение зафиксировано в ADR 0002: MinIO (dev/stage) + YOS (prod), шифрование через KMS, бэкапы Velero/pgBackRest. | Да — подтвердить при доступе к реальным условиям | Инфраструктура | Готово |
| Безопасность | Уровень защищённости ПДн, бэкапы, уведомления | В `docs/security/compliance.md` зафиксирован УЗ-2, описаны инструменты (pgBackRest, Velero) и добавлен шаблон уведомления ПДн. Требуется подтверждение DPO по уровню и сертификации. | Да — подтвердить с DPO при появлении | Ответственный за безопасность | Готово (ожидает подтверждения) |
| Интеграции | Каналы уведомлений и SLA | В `docs/architecture/integration-plan.md` определён порядок каналов (email → чат-бот → SMS), SLA и fallback, а также профиль по типам событий. | Да — скорректировать при реальной эксплуатации | Продакт (по факту) | Готово |
| Справочники | Перечень НПА и ссылки | Сформирован черновой список НПА в `reference-management.md` с ссылками и категориями; требуется подтверждение заказчика. | Да — при возможности сверить с заказчиком | Юрист/аналитик | Готово (ожидает верификации) |
| Notifications | Мониторинг и отладка интеграций | Решение описано в ADR 0002: Prometheus + Grafana + Loki + Alertmanager, алертинг через email/чат-бот, описан процесс бэкапов и мониторинга. | Нет | DevOps | Готово |
| Инфра | Runbook разработки и деплоя | Черновик runbook в `docs/infra/runbook.md`: локальный запуск, Git-процесс, CI/CD, TODO по .env и миграциям. | Нет | Инфраструктура | Готово (подлежит расширению) |
| Инфра | Локальное окружение docker + composer | Пересобран Dockerfile (запуск через `yii serve`), устранены ограничения SQLite, добавлен `composer.lock`; инструкция обновлена в runbook. | Нет | DevOps | Готово |
| UI | Базовый кабинет клиента и стили MVP | Реализован дашборд с метриками и вкладками, расширен `site.css`; готово для демонстрации MVP. | Нет | Frontend | Готово |
| Риски | Синхронизация статуса риска с требованием | `RequirementController::actionUpdateStatus` обновляет статус связанного риска (`open/mitigation/closed`), на вкладке «Карта требований» показывается значок «Есть риск». | Да — добавить тесты и связь с календарём | Backend | Готово (ожидает тестов) |
| Анкета клиента | Нет формы сбора исходных данных и генерации требований по ответам | Реализована анкета `/client/onboard` и обновлён RequirementBuilderService: ответы сохраняются в профиле клиента и автоматически формируют требования по правилам `docs/requirements/*.md`. | Да — подтвердить перечень вопросов у заказчика | Аналитик + Backend | Готово |
| Документы | Нет выбора режима загрузки (с аудитом / без) и self-service клиента | Пользовательские сценарии и поля `requires_audit` зафиксированы в `docs/features/document-storage.md`; осталось реализовать форму выбора режима и workflow аудита в Yii. | Да — согласовать бизнес-процесс аудита | Backend + Продакт | Готово (описание) / Требует реализации |
| Коммуникации | Веб-чат и обратный звонок (описание) | Создано подробное ТЗ `docs/features/chat-support.md`: модель данных, API, UX и инструкции для ИИ/разработчиков. Backend-скелет, веб-виджет с историей, real-time polling/indicator и операторский UI (`/chat/inbox`, `/chat/thread`) реализованы; далее — WebSocket, push-уведомления и Telegram-бот. | Да — подтвердить провайдера обратного звонка и SLA | Архитектор + Продакт | В процессе (основа готова) |
| Коммуникации | Telegram support-bot (операторский канал) | В `docs/architecture/integration-plan.md` добавлены сервис `support-bot`, события `chat.*`, авторизация `/login <token>`. Нужно выбрать стек (Node/Python), описать деплой/секреты и реализовать docker-сервис. | Да — после выбора стека и токена | Интеграционная команда | Не начато |
| DevOps/Monitoring | Наблюдаемость chat-service/бота | Добавлен раздел в `docs/infra/runbook.md` (миграции, curl-проверки, логи, черновик метрик/SLA). Следующий шаг — подключить реальные метрики и webhook после появления support-bot. | Да — после согласования с SRE | DevOps | В процессе (док) |
| Коммуникации | Realtime канал (WebSocket/SSE) | Пока работает polling (`GET /chat/<id>?since_id=…` каждые 5 сек). Следующий шаг — поднять Centrifugo/Redis gateway по `docs/architecture/chat-realtime.md`, чтобы отказаться от polling и добавить push-уведомления. | Да — после согласования стеков и ресурсов | Архитектор + Backend | В процессе (polling) |
| Календарь | Нет автоматического переноса дат после сдачи отчётов | Реализован пересчёт: при закрытии требования события с периодичностью автоматически отмечаются как выполненные и создаётся следующая дата (ежегодно/ежеквартально/ежемесячно/кастом). | Да — уточнить формулы повторения | Backend | Готово |
| Контент | Не реализована лента изменений законодательства и раздел снижения затрат/шаблонов | Раздел «НПА-лента» и процессы уведомлений описаны в `docs/features/risk-management.md` §10 и `docs/admin/reference-management.md`, но UI/CRUD отсутствуют. | Да — подтвердить перечень НПА и шаблонов | Контент + Frontend | Готово (описание) / Требует реализации |
| Интеграции | Mock Bubble есть, но нет реальной синхронизации | Контракт и mock API готовы (`docs/architecture/mock-bubble-api.md`), план интеграций — `docs/architecture/integration-plan.md`. Нужно описанное там внедрение `billing-service` и cron/webhook. | Да — согласовать контракт с Bubble | Интеграционная команда | Готово (описание) / Требует реализации |
| Админ-панель | Нет интерфейсов для НПА, пользователей и ручной правки требований | Функциональные требования к справочникам и overrides документированы (`docs/admin/reference-management.md`, `docs/admin/roles-and-permissions.md`), требуется фактический модуль `/admin`. | Да — уточнить состав справочников | Админ RBAC + Frontend | Готово (описание) / Требует реализации |
| Безопасность/Инфра | SQLite без RLS, нет резервного копирования ≥30 дней, SMTP не настроен | Политики безопасности, RLS и бэкапы описаны в `docs/security/compliance.md` и ADR-0002; нужно мигрировать на PostgreSQL, включить бэкапы и SMTP в окружении. | Да — синхронизировать с DevOps и DPO | DevOps + Backend | Готово (описание) / Требует реализации |

## Чек-лист обновления
- [x] Каждая запись содержит решение, которое команда может реализовать самостоятельно.
- [x] Все изменения отражаются в соответствующих документах и журналах completed.
- [x] После фактического выполнения задача переносится в `docs/completed/` с ссылкой на обновлённые файлы.
