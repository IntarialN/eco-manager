# Безопасность и соответствие

Документ описывает минимальные требования к безопасности MVP личного кабинета и меры соответствия законодательству РФ (в т.ч. 152-ФЗ), а также корпоративные стандарты хранения и обработки данных.

## 1. Нормативная база

- 152-ФЗ «О персональных данных» — обработка, хранение, защита ПДн.
- 7-ФЗ «Об охране окружающей среды», 96-ФЗ «Об охране атмосферного воздуха» — контекстные НПА.
- Постановление №1119 (требования к защите ПДн) — классификация и меры безопасности.
- ГОСТ Р 57580 (при работе с финансовыми данными) — учитывать при хранении договоров/счетов.
- Внутренние регламенты заказчика («Политика ПДн», инструкции по резервному копированию).
- TODO: подтвердить наличие сертификатов/аттестатов защиты информации (если требуется).

## 2. Классификация данных

- `Персональные данные`: контактные сведения пользователей, ответственных лиц.
- `Коммерческая тайна`: данные договоров, расчёты, документы клиента.
- `Регуляторные сведения`: отчёты, лицензии, требования — хранятся в защищённом виде.
- Уровень защищённости ПДн: принимаем рабочее решение — УЗ-2 (персональные данные средней категории, автоматизированная обработка). Требуется подтверждение DPO заказчика; в план включены меры УЗ-2 (контроль доступа, журналирование, резервирование).

## 3. Архитектурные меры безопасности

- RLS-политики на уровне БД (строка привязана к `client_id`/`site_id`).
- Ролевая модель (см. `docs/admin/roles-and-permissions.md`).
- Разделение сервисов (микросервисная/модульная архитектура) — минимум: auth, backend, storage, audit.
- Шифрование:
  - Данные в покое: шифрование БД (TDE) и хранилища файлов.
  - Данные при передаче: TLS 1.2+, строгая политика HTTPS (HSTS).
- Управление секретами: централизованное хранилище (Vault/Secrets Manager), ротация ключей.

## 4. Процессы обработки ПДн

- Согласие на обработку ПДн (электронная форма, хранится в системе).
- Минимизация данных: собираем только необходимые поля.
- Доступ сотрудников — по принципу минимальных привилегий.
- Регистрация всех операций с ПДн в журнале (`AuditLog`).
- Право на удаление/редактирование по запросу субъекта (портал клиента).
- Уведомление о нарушениях ПДн — в течение 72 часов.

## 5. Резервное копирование и восстановление

- Бэкап БД — ежедневно, хранение ≥ 30 дней, гео-избыточность (минимум 2 площадки) с использованием `pgBackRest` (prod) и snapshotов в dev/stage.
- Бэкап storage — инкрементальный, раз в 24 часа, хранение ≥ 30 дней (MinIO replication → Yandex Object Storage).
- Проверка восстановления — раз в месяц (тестовое восстановление на отдельном стенде согласно runbook).
- План аварийного восстановления (DRP): RTO ≤ 8 часов, RPO ≤ 24 часов. Описан в `docs/infra/runbook.md` (будет дополнен).
- Для stage/prod используется Velero (бэкап конфигурации Kubernetes) + автоматизированные отчёты об успешном выполнении.

## 6. Аудит и мониторинг

- Логирование:
  - Успешные/неуспешные входы.
  - Операции с требованиями, документами, договорами и ПДн.
- SIEM/мониторинг для анализа инцидентов (опционально на MVP стадии).
- Уведомления админам при подозрительной активности (много неудачных логинов, массовые выгрузки).
- Регулярный анализ уязвимостей (сканеры, Pen-test перед релизом).

## 7. Соответствие интеграций

- API Бабл: использовать защищённые соединения, ограничить токены доступа.
- Интеграции с внешними сервисами — по минимально необходимым привилегиям.
- Хранение логов интеграций ≥ 1 год для возможности расследования.

## 8. Политики хранения документов

- Доступ к файлам через временные ссылки (подписанные URL).
- Контроль версий и возможность отката.
- Удаление файлов — мягкое (soft delete) с возможностью восстановления 30 дней.
- На prod проверяем соответствие хранилища требованиям ФСТЭК/ФСБ (YOS имеет сертификаты; при смене провайдера обновляем раздел).

## 9. Тестирование безопасности

- Статический анализ кода (SAST) перед релизом.
- Динамический анализ (DAST) для веб-приложения.
- Тесты на RLS и изоляцию данных (попытка доступа к чужим строкам).
- Пентест по чек-листу OWASP Top 10 и требованиям 152-ФЗ.

## 10. Коммуникации и процедуры

- Назначить ответственного за безопасность (DPO/информационная безопасность).
- Регламент реагирования: обнаружение → оценка → закрытие → сообщение заказчику.
- Обучение сотрудников: ежегодный курс по ПДн и кибербезопасности.
- Шаблон уведомления о нарушении ПДн:
  ```
  Тема: Уведомление о нарушении персональных данных

  Уважаемый(ая) <ФИО/организация>!

  1. Дата и время инцидента: <ДД.ММ.ГГГГ ЧЧ:ММ>.
  2. Содержание инцидента: (краткое описание, какие данные оказались под угрозой, обстоятельства).
  3. Принятые меры: (меры по локализации, уведомление субъектов, дополнительные действия).
  4. Контактное лицо: <ФИО, должность, телефон, email>.
  5. Дополнительная информация: (при необходимости).

  Просим связаться с нами для получения дальнейших разъяснений.

  С уважением,
  <Компания / ответственное лицо>
  ```
- План взаимодействия с регулятором: уведомление Роскомнадзора в течение 72 часов, предоставление отчёта о мерах, фиксация в журнале инцидентов.

## Чек-лист готовности

- [x] Описана нормативная база и классификация данных.
- [x] Зафиксированы меры по RLS, шифрованию, обработке ПДн.
- [x] Определены требования по бэкапам, аудиту, интеграциям.
- [x] Описаны процедуры тестирования и реагирования.
- [ ] Подтверждён уровень защищённости ПДн и сертификация провайдера (ожидает данных заказчика).

## Связанные документы и регламент обновлений

- `docs/admin/roles-and-permissions.md` — политика доступа и RLS.
- `docs/features/*.md` — блоки, где описаны требования к журналированию и безопасности.
- `docs/infra/runbook.md` — процедуры бэкапов, мониторинга и реагирования.
- `docs/architecture/adr/*.md` — принятые решения по стеку/инфраструктуре.
- `docs/documentation-todo.md`, `docs/completed/` — статусы задач и журнал изменений.

Перед обновлением документа:
1. Уточнить изменения нормативных требований или инфраструктуры (ADR, runbook).
2. Обновить связанные документы и TODO/Completed, чтобы команда видела, что изменилось.
3. Зафиксировать подтверждения (уровень защищённости, провайдеры) в completed-логе с ссылками на источники.
