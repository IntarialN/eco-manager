# SSE/long-poll канал чата

**Контекст**
- Требовалось обеспечить «живые» сообщения без ручного обновления.
- До этого фронт делал обычный polling на `/chat/<id>`, что давало задержку 5–15 секунд.

**Что сделано**
1. Добавлен endpoint `GET /chat/<id>/stream` (`ChatController::actionStream`) — long-poll JSON с таймаутом 25 секунд, который отдаёт новые сообщения как только они появляются.
2. JS-виджет (`yii-app/views/layouts/main.php`) теперь держит постоянное соединение (через повторяющиеся `fetch`) + fallback polling раз в 15 секунд. При 404 (устарела сессия) storage очищается и чат начинается заново.
3. UI обновлён: кнопка доступна только клиентам (операторы её не видят), панель появляется с анимацией и не перекрывает экран по умолчанию.
4. Документация: `docs/features/chat-support.md`, `docs/infra/runbook.md`, `docs/documentation-todo.md` отражают новый канал и текущий статус (SSE fallback есть, gateway в планах).

**Следующие шаги**
- Поднять полноценный gateway (Centrifugo/Redis) по `docs/architecture/chat-realtime.md` для push-событий в операторский UI и бота.
- Добавить метрики по разрывам streaming-соединений.
